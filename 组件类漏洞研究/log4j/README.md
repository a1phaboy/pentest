# log4j攻击链分析

主要由2个主要函数，一个是format函数，format主要用于处理传入的字符串，当检测到"${"后，会调用replace方法，replace方法调用substitute。

![image-20220610151747249](image-20220610151747249.png)



在substitute中，调用到了resolveVariable

![image-20220610153454257](image-20220610153454257.png)

在这里会真正调用lookup函数

![image-20220610153404477](image-20220610153404477.png)

在lookup函数中，定义了一个strlookupMap其中就包含了包括jndi在内的几种处理方式，然后进入lookup.lookup函数

![image-20220610153553019](image-20220610153553019.png)

在此调用jndi的lookup方法，从而产生jndi注入

![image-20220610154057851](image-20220610154057851.png)